GYP=$(shell which node-gyp)
NODE=$(shell which node)
NODEVERSION=$(shell $(NODE) --version)
OSNAME=$(shell uname | sed y/ABCDEFGHIJKLMNOPQRSTUVXY/abcdefghijklmnopqrstuvxy/)
OSARCH=$(shell uname -m)
INSTALL_PATH=../vfs-node/node_modules/im

all: build

build: config
	@$(GYP) $(GYPFLAGS) --verbose build	

config: $(GYP)
	@$(GYP) $(GYPFLAGS) configure

clean:
	@$(GYP) $(GYPFLAGS) clean

distclean: clean
	@rm -rf build node_modules

dist: build
	@mkdir -p node_modules/im-$(OSNAME)-$(OSARCH)
	@cp build/Release/im.node node_modules/im-$(OSNAME)-$(OSARCH)/
	@cp src/package.json node_modules/im-$(OSNAME)-$(OSARCH)/package.json

install: dist
	@mkdir -p $(INSTALL_PATH)
	@cp package.json index.js $(INSTALL_PATH)
	@cp -r node_modules $(INSTALL_PATH)	 

test: dist
	@$(MAKE) -C tests
